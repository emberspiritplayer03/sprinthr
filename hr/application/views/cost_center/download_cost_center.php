<?php
ob_start();
?>
<style type="text/css">
  @import "<?php echo 'http://' . $_SERVER['HTTP_HOST'] . BASE_FOLDER; ?>themes/default/cost_center_stylesheet2.css";
</style>

<table border=0 cellpadding=0 cellspacing=0 width=8220 style='border-collapse:
 collapse;table-layout:fixed;width:6164pt'>
  <col width=76 span=2 style='mso-width-source:userset;mso-width-alt:2779;
 width:57pt'>
  <col class=xl65 width=76 style='mso-width-source:userset;mso-width-alt:2779;
 width:57pt'>
  <col class=xl65 width=64 span=2 style='width:48pt'>
  <col width=177 style='mso-width-source:userset;mso-width-alt:6473;width:133pt'>
  <col width=64 style='width:48pt'>
  <col width=70 style='mso-width-source:userset;mso-width-alt:2560;width:53pt'>
  <col width=64 span=6 style='width:48pt'>
  <col class=xl66 width=70 style='mso-width-source:userset;mso-width-alt:2560;
 width:53pt'>
  <col width=79 span=3 style='mso-width-source:userset;mso-width-alt:2889;
 width:59pt'>
  <col width=72 style='mso-width-source:userset;mso-width-alt:2633;width:54pt'>
  <col width=76 style='mso-width-source:userset;mso-width-alt:2779;width:57pt'>
  <col width=86 style='mso-width-source:userset;mso-width-alt:3145;width:65pt'>
  <col width=82 style='mso-width-source:userset;mso-width-alt:2998;width:62pt'>
  <col width=78 style='mso-width-source:userset;mso-width-alt:2852;width:59pt'>
  <col width=72 span=5 style='mso-width-source:userset;mso-width-alt:2633;
 width:54pt'>
  <col width=74 style='mso-width-source:userset;mso-width-alt:2706;width:56pt'>
  <col width=75 span=2 style='mso-width-source:userset;mso-width-alt:2742;
 width:56pt'>
  <col width=76 style='mso-width-source:userset;mso-width-alt:2779;width:57pt'>
  <col width=72 style='mso-width-source:userset;mso-width-alt:2633;width:54pt'>
  <col width=75 style='mso-width-source:userset;mso-width-alt:2742;width:56pt'>
  <col width=77 style='mso-width-source:userset;mso-width-alt:2816;width:58pt'>
  <col width=95 style='mso-width-source:userset;mso-width-alt:3474;width:71pt'>
  <col width=107 span=14 style='mso-width-source:userset;mso-width-alt:3913;
 width:80pt'>
  <col width=91 style='mso-width-source:userset;mso-width-alt:3328;width:68pt'>
  <col width=78 span=2 style='mso-width-source:userset;mso-width-alt:2852;
 width:59pt'>
  <col width=83 style='mso-width-source:userset;mso-width-alt:3035;width:62pt'>
  <col width=64 span=11 style='width:48pt'>
  <col width=105 style='mso-width-source:userset;mso-width-alt:3840;width:79pt'>
  <col width=64 span=5 style='width:48pt'>
  <col width=78 style='mso-width-source:userset;mso-width-alt:2852;width:59pt'>
  <col width=64 span=2 style='width:48pt'>
  <col width=79 style='mso-width-source:userset;mso-width-alt:2889;width:59pt'>
  <col width=64 span=16 style='width:48pt'>
  <col width=71 style='mso-width-source:userset;mso-width-alt:2596;width:53pt'>
  <col width=64 span=18 style='width:48pt'>
  <tr height=30 style='height:22.5pt'>
    <td colspan=54 height=30 class=xl80 width=4559 style='height:22.5pt;
  width:3418pt'><?php echo $header['company_name'] ?></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=105 style='width:79pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=78 style='width:59pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=79 style='width:59pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td class=xl67 width=71 style='width:53pt'></td>
    <td class=xl67 width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
  </tr>
  <tr height=25 style='height:18.75pt'>
    <td colspan=54 height=25 class=xl81 style='height:18.75pt'>Finance &amp;
      Accounting Dept. - Payroll</td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td colspan=17 style='mso-ignore:colspan'></td>
  </tr>
  <tr height=20 style='height:15.0pt'>
    <td colspan=54 height=20 class=xl82 style='height:15.0pt'>Payroll Computation
      for the period of: <?= date("M d, Y", strtotime($from)) ?> to <?= date("M d, Y", strtotime($to)) ?></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td colspan=17 style='mso-ignore:colspan'></td>
  </tr>
  <tr height=20 style='height:15.0pt'>
    <td height=20 class=xl67 style='height:15.0pt'></td>
    <td class=xl67></td>
    <td class=xl68></td>
    <td class=xl68></td>
    <td class=xl68></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl69></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td colspan=17 style='mso-ignore:colspan'></td>
  </tr>

  <?php
  $other_deduction_label_container = [];
  foreach ($grouped_data as $cost_center_key => $cost_center_data) {

    ksort($cost_center_data);
    $sub_total     = array();
    $employee_taxable_earnings = 0;

    $earnings_benefits_label_array = array();
    $other_deduction_label_array   = array();
    foreach ($cost_center_data as $cdata) {
      $employee_id                     = $cdata['id'];
      $payslipDataBuilder              = new G_Payslip();
      $payslip_section_other_earnings  = $payslipDataBuilder->wrapPayslipArray($payslips[$employee_id])->getPayslipData('other_earnings', 2);
      $other_deductions_only           = $payslipDataBuilder->wrapPayslipArray($payslips[$employee_id])->getPayslipData('other_deductions', 2);

      foreach ($payslip_section_other_earnings as $psoe_key => $psoe) {
        $earnings_benefits_label_array[$psoe_key] = $psoe['label'];
      }

      $obj_other_deductions = unserialize($payslips[$employee_id]['other_deductions']);
      foreach ($obj_other_deductions as $other_deduction) {
          array_push($other_deduction_label_container, $other_deduction->getLabel());
      }

      foreach ($other_deductions_only as $odo_key => $odo) {
        if (($odo_key !== 'sss_salary_loan') && ($odo_key !== 'pagibig_salary_loan')) {
          $other_deduction_label_array[$odo_key] = $odo['label'];
        }
      }
    }

    $other_deduction_label_container = array_unique($other_deduction_label_container);
    $loan_label_container = [];
    
    $lt = new G_Loan_Deduction_Type();
		$government_loan_ids = $lt->government_loan_type_ids;
    $loan_types = G_Loan_Type_Finder::findAllIsNotArchive();
    
    //Filter Loan Types 
    foreach($other_deduction_label_container as $other_deduction){
      foreach($loan_types as $loan_type){
        if( !in_array($loan_id, $government_loan_ids) &&   $other_deduction == $loan_type->getLoanType()){
          array_push($loan_label_container, $other_deduction);
        }
      }
    }

  }

  ?>

  <tr height=86 style='height:64.5pt'>
    <td height=86 class=xl70 width=76 style='height:64.5pt;width:57pt'>EMP CODE</td>
    <!-- <td class=xl70 width=76 style='border-left:none;width:57pt'>DATE HIRED</td> -->
    <td class=xl71 width=76 style='width:57pt'>EMP STATUS</td>
    <td class=xl71 width=64 style='width:48pt'>
      <!-- COST CENTER -->PROJECT SITE</td>
    <!-- <td class=xl71 width=64 style='width:48pt'>PAY STATUS</td> -->
    <td class=xl71 width=177 style='width:150pt'>EMPLOYEE NAME</td>
    <!-- new -->
    <td class=xl71 width=177 style='width:133pt'>DEPARTMENT</td>
    <td class=xl71 width=177 style='width:133pt'>SECTION</td>
    <td class=xl71 width=177 style='width:133pt'>PAY FREQUENCY</td>
    <!-- new -->

    <!-- <td class=xl71 width=64 style='width:48pt'>TAX STATUS</td>
  <td class=xl71 width=70 style='width:53pt'>MONTHLY BASIC PAY</td>
  <td class=xl71 width=64 style='width:48pt'>DAILY RATE</td>
  <td class=xl71 width=64 style='width:48pt'>HOURLY RATE</td>
  <td class=xl71 width=64 style='width:48pt'>FULL HOURS</td>
  <td class=xl71 width=64 style='width:48pt'>BASIC PAY</td> -->

    <!-- <td class=xl71 width=64 style='width:48pt'>SL</td>
  <td class=xl71 width=64 style='width:48pt'>VL</td> -->

    <!--  <td class=xl71 width=70 style='width:53pt'>SLVL</td> -->
    <!-- <td class=xl71 width=79 style='width:59pt'>LEGAL HOLIDAY</td> -->

    <!-- <td class=xl71 width=79 style='width:59pt'>BIL</td>
  <td class=xl71 width=72 style='width:59pt'>TARDINESS</td>
  <td class=xl71 width=72 style='width:54pt'>UNDERTIME</td>
  <td class=xl71 width=72 style='width:57pt'>LATE</td>   -->

    <!-- 
  <td class=xl92 width=79 style='width:59pt'>HOLIDAY FALLS ON SUNDAY</td>
  <td class=xl71 width=72 style='width:54pt'>BIL SUNDAY</td>
  <td class=xl71 width=76 style='width:57pt'>Rice Subsidy</td>
  <td class=xl71 width=86 style='width:65pt'>RETRO Basic</td>
  <td class=xl71 width=82 style='width:62pt'>PRIOR DAYS</td> 
  -->

    <td class=xl93 width=78 style='width:59pt'>TOTAL BASIC PAY</td>

    <!-- <td class=xl94 width=72 style='width:54pt'>Regular NS</td>
  <td class=xl94 width=72 style='width:54pt'>Regular NSOT</td>
  <td class=xl94 width=72 style='width:54pt'>Holiday Special NS</td>
  <td class=xl94 width=72 style='width:54pt'>RestDay Holiday Special NS</td>
  <td class=xl94 width=72 style='width:54pt'>Holiday Special NSOT</td>
  <td class=xl94 width=74 style='width:56pt'>Restday Holiday Special NSOT</td>
  <td class=xl94 width=75 style='width:56pt'>RestDay NS</td>
  <td class=xl94 width=75 style='width:56pt'>Restday NSOT</td>
  <td class=xl94 width=76 style='width:57pt'>Holiday Legal NS</td>
  <td class=xl94 width=72 style='width:54pt'>Holiday Legal NSOT</td>
  <td class=xl94 width=75 style='width:56pt'>RestDay Holiday Legal NS</td>
  <td class=xl94 width=77 style='width:58pt'>Restday Holiday Legal NSOT</td> -->

    <td class=xl95 width=95 style='width:71pt'>TOTAL NIGHTSHIFT</td>

    <!-- <td class=xl91 width=107 style='width:80pt'>Regular OT</td>
  <td class=xl91 width=107 style='width:80pt'>Holiday Legal</td>
  <td class=xl91 width=107 style='width:80pt'>Holiday Legal OT</td>
  <td class=xl91 width=107 style='width:80pt'>RestDay Holiday Legal</td>
  <td class=xl91 width=107 style='width:80pt'>RestDay Holiday Legal OT</td>
  <td class=xl91 width=107 style='width:80pt'>Rest Day</td>
  <td class=xl91 width=107 style='width:80pt'>Rest day OT</td>
  <td class=xl91 width=107 style='width:80pt'>Holiday Special</td>
  <td class=xl91 width=107 style='width:80pt'>Holiday Special OT</td>
  <td class=xl91 width=107 style='width:80pt'>Rest day Holiday Special</td>
  <td class=xl91 width=107 style='width:80pt'>Rest day Holiday Special OT</td> -->

    <!--
  <td class=xl91 width=107 style='width:80pt'>RETRO OT</td>
  <td class=xl91 width=107 style='width:80pt'>PRIOR OT/Posting Allowance</td>
  -->

    <td class=xl86 width=91 style='width:68pt'>TOTAL OVERTIME</td>

    <!-- <td class=xl90 width=78 style='width:59pt'>MPF_ATTENDANCE</td>
  <td class=xl71 width=78 style='width:59pt'>Seniority</td>
  <td class=xl71 width=83 style='width:62pt'>TRANSPO</td>
  <td class=xl71 width=64 style='width:48pt'>MEAL</td>
  <td class=xl90 width=64 style='width:48pt'>COLA | Allowance</td>
  <td class=xl71 width=64 style='width:48pt'>Prior Transpo</td>
  <td class=xl90 width=64 style='width:48pt'>Prior Allowance / CTPA</td> -->
    <!-- Earnings Here -->

    <!-- <?php foreach ($earnings_benefits_label_array as $ebla_key => $ebla) { ?>
          <td class=xl71 width=78 style='width:59pt'><?php echo $ebla; ?></td>
  <?php } ?> -->

    <td class=xl71 width=64 style='width:48pt'>STAFF BENEFIT</td>
    <td class=xl87 width=64 style='width:48pt'>GROSS PAY</td>
    <td class=xl90 width=64 style='width:48pt'>TAXABLE INCOME</td>
    <!-- <td class=xl90 width=64 style='width:48pt'>GOV'T DEDUCT &amp; UNION DUES</td> -->
    <td class=xl71 width=64 style='width:48pt'>PH</td>
    <td class=xl71 width=64 style='width:48pt'>SSS</td>
    <td class=xl71 width=64 style='width:48pt'>PAGIBIG</td>
    <td class=xl90 width=105 style='width:79pt'>WITHHOLDING TAX</td>

    <!-- <td class=xl90 width=64 style='width:48pt'>HDMF LOAN</td>
  <td class=xl90 width=64 style='width:48pt'>HDMF CALAMITY</td>
  <td class=xl71 width=64 style='width:48pt'>SSS LOAN</td> -->

    <!-- <td class=xl88 width=64 style='width:48pt'>VACCINE/ MEDICINE/ Excess on SSS/cellphone bills</td>
  <td class=xl89 width=64 style='width:48pt'>TELEPHONE</td>
  <td class=xl93 width=78 style='width:59pt'>OTHER DEDUCTION (4K FIN ASST)</td>
  <td class=xl93 width=64 style='width:48pt'>MAXICARE</td>
  <td class=xl93 width=64 style='width:48pt'>HOSPITAL BILL</td>
  <td class=xl90 width=79 style='width:59pt'>TAX ADJUSTMENT</td>
  <td class=xl93 width=64 style='width:48pt'>Educational loan</td>
  <td class=xl93 width=64 style='width:48pt'>MULTI PURPOSE LOAN</td>
  <td class=xl93 width=64 style='width:48pt'>MERCURY LOAN</td>
  <td class=xl93 width=64 style='width:48pt'>CALAMITY LOAN</td>
  <td class=xl93 width=64 style='width:48pt'>ARAP CLEARING</td>
  <td class=xl90 width=64 style='width:48pt'>SAMASA</td>
  <td class=xl90 width=64 style='width:48pt'>SAMASA BURIAL ASSISTANCE</td>
  <td class=xl90 width=64 style='width:48pt'>SAMASA LOANS</td>
  <td class=xl90 width=64 style='width:48pt'>NAMAWU</td>
  <td class=xl90 width=64 style='width:48pt'>CANTEEN</td>
  <td class=xl90 width=64 style='width:48pt'>IDEAL VISION</td>
  <td class=xl90 width=64 style='width:48pt'>ASI OPTICAL</td>
  <td class=xl90 width=64 style='width:48pt'>COOP</td>
  <td class=xl90 width=64 style='width:48pt'>HOMECREDIT</td>
  <td class=xl90 width=64 style='width:48pt'>CAPEX</td>
  <td class=xl90 width=64 style='width:48pt'>UN_MICROLOAN</td> -->

    <!-- <?php foreach ($other_deduction_label_array as $odla_key => $odla) { ?>
          <td class=xl90 width=78 style='width:59pt'><?php echo $odla; ?></td>
  <?php } ?> -->

    <!-- <td class=xl90 width=71 style='width:53pt'>STAFF BENEFIT DEDUCTIONS / OTHER ADJ</td> -->
    <?php foreach($loan_label_container as $loan_type) { ?>
            <td class=xl90 width=78 style='width:59pt'><?php echo strtoupper($loan_type); ?></td>
    <?php } ?>
    <td class=xl90 width=71 style='width:53pt'>OTHER DEDUCTION</td>
    <td class=xl90 width=71 style='width:53pt'>NET PAY</td>
    <td class=xl90 width=64 style='width:48pt'>ARAP CLEARING</td>
    <td class=xl90 width=64 style='width:48pt'>PAYROLL CLEARING</td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
  </tr>

  <tr height=20 style='height:15.0pt'>
    <td height=20 class=xl67 style='height:15.0pt'></td>
    <td class=xl67></td>
    <td class=xl68></td>
    <td class=xl68></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <!-- <td class=xl69></td> -->
    <td class=xl67></td>

    <!-- 
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td> 
  -->

    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>

    <!-- 
  <td class=xl67></td>
  <td class=xl67></td> 
  -->

    <td class=xl67></td>

    <!-- <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td> -->
    <?php foreach ($earnings_benefits_label_array as $ebla_key => $ebla) { ?>
      <td class=xl67></td>
    <?php } ?>

    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td colspan=16 style='mso-ignore:colspan'></td>
  </tr>

  <?php
  $grand_total  = array();;
  array_multisort($grouped_data, SORT_ASC, SORT_REGULAR);
  ?>

  <?php foreach ($grouped_data as $cost_center_key => $cost_center_data) { ?>

    <?php
    ksort($cost_center_data);
    $sub_total     = array();
    $employee_taxable_earnings = 0;
    
    foreach($loan_label_container as $loan_type){
      $sub_total[$loan_type] = 0;
    }
    ?>

    <?php foreach ($cost_center_data as $cdata) { ?>
      <?php

      $employee_id    = $cdata['id'];
      $employee_code  = $cdata['employee_code'];
      $lastname       = mb_convert_encoding($cdata['lastname'], "HTML-ENTITIES", "UTF-8");
      $firstname      = mb_convert_encoding($cdata['firstname'], "HTML-ENTITIES", "UTF-8");
      $marital_status = $cdata['marital_status'];
      $number_dependent = $cdata['number_dependent'];
      $department_name = $cdata['department_name'];
      $section_name   = $cdata['section_name'];
      $frequency_type = $frequency_type;
      $payslip        = $payslips[$employee_id];
      $taxable        = $payslips[$employee_id]['taxable'];
      $witholding_tax = $payslips[$employee_id]['withheld_tax'];
      $pagibig        = $payslips[$employee_id]['pagibig'];
      $sss            = $payslips[$employee_id]['sss'];
      $philhealth     = $payslips[$employee_id]['philhealth'];
      $net_pay        = $payslips[$employee_id]['net_pay'];

      if ($marital_status == 'Married') {
        $marital_status = 'M';
      } elseif ($marital_status == 'Single') {
        $marital_status = 'S';
      }

      $obj_earnings = unserialize($payslips[$employee_id]['earnings']);
      $obj_other_earnings = unserialize($payslips[$employee_id]['other_earnings']);
      $obj_labels   = unserialize($payslips[$employee_id]['labels']);

      $payslip_section_earnings  = array();

      $payslipDataBuilder              = new G_Payslip();
      $payslip_section_earnings        = $payslipDataBuilder->wrapPayslipArray($payslips[$employee_id])->getPayslipData('earnings', 2);
      $payslip_section_other_earnings  = $payslipDataBuilder->wrapPayslipArray($payslips[$employee_id])->getPayslipData('other_earnings', 2);
      $payslip_section_deduction       = $payslipDataBuilder->wrapPayslipArray($payslips[$employee_id])->getPayslipData('deductions', 2);
      $other_deductions_only           = $payslipDataBuilder->wrapPayslipArray($payslips[$employee_id])->getPayslipData('other_deductions', 2);

      $leave_attendance     = G_Attendance_Finder::findAttendanceWithLeaveAndPaidByEmployeeAndPeriod($employee_id, $from, $to);

      $sick_and_vacation_leave = 0;
      $sick_leave_count        = 0;
      $vacation_leave_count    = 0;
      $birthday_leave          = 0;
      foreach ($leave_attendance as $la) {
        if ($la->getLeaveId() == 1) {
          $sick_and_vacation_leave++;
          $sick_leave_count++;
        } elseif ($la->getLeaveId() == 2) {
          $sick_and_vacation_leave++;
          $vacation_leave_count++;
        }
        if ($la->getLeaveId() == 5) {
          $birthday_leave++;
        }
      }

      /* OT Variable */
      $regular_ot_amount        = 0;
      $holiday_legal_amount     = 0;
      $holiday_legal_ot_amount  = 0;
      $restday_legal_amount     = 0;
      $restday_legal_ot_amount  = 0;
      $restday_amount           = 0;
      $restday_ot_amount        = 0;
      $holiday_special_amount   = 0;
      $holiday_special_ot_amount  = 0;
      $restday_special_amount     = 0;
      $restday_special_ot_amount  = 0;
      /* OT Variable End */

      /* Nightshift Variable */
      $regular_ns_amount            = 0;
      $regular_ns_ot_amount         = 0;
      $holiday_special_ns_amount    = 0;
      $restday_special_ns_amount    = 0;
      $holiday_special_ns_ot_amount = 0;
      $restday_special_ns_ot_amount = 0;
      $restday_ns_amount            = 0;
      $restday_ns_ot_amount         = 0;
      $holiday_legal_ns_amount      = 0;
      $holiday_legal_ns_ot_amount   = 0;
      $restday_legal_ns_amount      = 0;
      $restday_legal_ns_ot_amount   = 0;
      /* Nightshift End */

      $emp_monthly_rate         = 0;
      $emp_daily_rate           = 0;
      $emp_hourly_rate          = 0;
      $emp_legal_holiday_amount = 0;
      $emp_present_days         = 0;
      $emp_salary_type = '';
      foreach ($obj_labels as $obj) {

        if ($obj->getVariable() == 'monthly_rate') {
          $emp_monthly_rate = $obj->getValue();
        }

        if ($obj->getVariable() == 'daily_rate') {
          $emp_daily_rate = $obj->getValue();
        }

        if ($obj->getVariable() == 'hourly_rate') {
          $emp_hourly_rate = $obj->getValue();
        }

        if ($obj->getVariable() == 'holiday_legal_amount') {
          $emp_legal_holiday_amount += $obj->getValue();
        }

        if ($obj->getVariable() == 'salary_type') {
          $emp_salary_type = $obj->getValue();
        }

        if ($obj->getVariable() == 'present_days_with_pay') {
          $emp_present_days = $obj->getValue();
        }

        /* nightshift */
        if ($obj->getVariable() == 'regular_ns_amount') {
          $regular_ns_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'regular_ns_ot_amount') {
          $regular_ns_ot_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'holiday_special_ns_amount') {
          $holiday_special_ns_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'restday_special_ns_amount') {
          $restday_special_ns_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'holiday_special_ns_ot_amount') {
          $holiday_special_ns_ot_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'restday_special_ns_ot_amount') {
          $restday_special_ns_ot_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'restday_ns_amount') {
          $restday_ns_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'restday_ns_ot_amount') {
          $restday_ns_ot_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'holiday_legal_ns_amount') {
          $holiday_legal_ns_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'holiday_legal_ns_ot_amount') {
          $holiday_legal_ns_ot_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'restday_legal_ns_amount') {
          $restday_legal_ns_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'restday_legal_ns_ot_amount') {
          $restday_legal_ns_ot_amount = $obj->getValue();
        }
        /* nightshift end */

        /* OT */
        if ($obj->getVariable() == 'regular_ot_amount') {
          $regular_ot_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'holiday_legal_amount') {
          $holiday_legal_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'holiday_legal_ot_amount') {
          $holiday_legal_ot_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'restday_legal_amount') {
          $restday_legal_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'restday_legal_ot_amount') {
          $restday_legal_ot_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'restday_amount') {
          $restday_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'restday_ot_amount') {
          $restday_ot_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'holiday_special_amount') {
          $holiday_special_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'holiday_special_ot_amount') {
          $holiday_special_ot_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'restday_special_amount') {
          $restday_special_amount = $obj->getValue();
        }
        if ($obj->getVariable() == 'restday_special_ot_amount') {
          $restday_special_ot_amount = $obj->getValue();
        }
        /* OT end */
      }

      foreach ($obj_earnings as $te) {
        if ($te->getTaxType() == 1) {
          $employee_taxable_earnings = $te->getAmount();
        }
      }

      foreach ($obj_other_earnings as $oe) {
        if ($oe->getTaxType() == 1) {
          $employee_taxable_earnings += $oe->getAmount();
        }
      }

      /* Earnings / Benefits */

      $earnings_benefits_seniority_total = 0;
      $earnings_benefits_seniority = array('seniority_allowance', 'seniority_pay');
      foreach ($payslip_section_other_earnings as $earning_key => $e_deduction) {
        foreach ($earnings_benefits_seniority as $key) {
          if (stripos($earning_key, $key) !== false) {
            $earnings_benefits_seniority_total += $payslip_section_other_earnings[$earning_key]['value'];
          }
        }
      }

      $earnings_benefits_transpo_total = 0;
      $earnings_benefits_transpo = array('transportation_allowance');
      foreach ($payslip_section_other_earnings as $earning_key => $e_deduction) {
        foreach ($earnings_benefits_transpo as $key) {
          if (stripos($earning_key, $key) !== false) {
            $earnings_benefits_transpo_total += $payslip_section_other_earnings[$earning_key]['value'];
          }
        }
      }

      $earnings_benefits_meal_total = 0;
      $earnings_benefits_meal = array('meal');
      foreach ($payslip_section_other_earnings as $earning_key => $e_deduction) {
        foreach ($earnings_benefits_meal as $key) {
          if (stripos($earning_key, $key) !== false) {
            $earnings_benefits_meal_total += $payslip_section_other_earnings[$earning_key]['value'];
          }
        }
      }

      /* Earnings / Benefits - End */

      $other_earnings = 0;
      foreach ($payslip_section_other_earnings as $o_key => $o_data) {
        if ($o_data['value'] != '' && $o_data['value'] > 0) {
          $other_earnings += $o_data['value'];
        }
      }

      $total_govt_deductions_unions = 0;
      $total_govt_deductions_unions = $pagibig + $sss + $philhealth;

      $staff_benefits = $other_earnings;
      $slvl = ($sick_and_vacation_leave * $emp_daily_rate);
      $sl   = ($sick_leave_count * $emp_daily_rate);
      $vl   = ($vacation_leave_count * $emp_daily_rate);
      $bil  = ($birthday_leave * $emp_daily_rate);

      $full_hours = 0;
      $tardiness  = 0;
      $undertime  = 0;
      $absent     = 0;

      $tardiness = $payslip_section_deduction['late_amount']['value'];
      $undertime = $payslip_section_deduction['undertime_amount']['value'];
      $absent    = $payslip_section_deduction['absent_amount']['value'];
      $full_hours = $emp_present_days * 8;

      //$overtime_amount     = $payslip_section_earnings['total_regular_ot_amount']['value'] + $payslip_section_earnings['total_regular_ns_ot_amount']['value'] + $payslip_section_earnings['total_legal_ot_amount']['value'] + $payslip_section_earnings['total_legal_ns_ot_amount']['value'] + $payslip_section_earnings['total_special_ns_ot_amount']['value'] + $payslip_section_earnings['total_special_ot_amount']['value'] + $payslip_section_earnings['total_rest_day_ot']['value'] + $payslip_section_earnings['total_rest_day_special_ot']['value'] + $payslip_section_earnings['total_rest_day_special']['value'] + $payslip_section_earnings['total_rest_day_legal_ot']['value'] + $total_rd_amount + $payslip_section_earnings['total_rest_day_ns_ot']['value'] + $payslip_section_earnings['total_rest_day_legal']['value'] + $payslip_section_earnings['total_rest_day_special_ns_ot']['value'];
      $overtime_amount     = $regular_ot_amount + $holiday_legal_amount + $holiday_legal_ot_amount + $restday_legal_amount + $restday_legal_ot_amount + $restday_amount + $restday_ot_amount + $holiday_special_amount + $holiday_special_ot_amount + $restday_special_amount + $restday_special_ot_amount;
      $basic_pay           = $payslip_section_earnings['basic_pay']['value'];
      // $total_basic_pay     = $payslip_section_earnings['basic_pay']['value'] - ($tardiness + $undertime + $absent);
      $total_basic_pay     = $payslip_section_earnings['basic_pay']['value'];
      $total_nightshift    = $regular_ns_amount + $regular_ns_ot_amount + $holiday_special_ns_amount + $restday_special_ns_amount + $holiday_special_ns_ot_amount + $restday_special_ns_ot_amount + $restday_ns_amount + $restday_ns_ot_amount + $holiday_legal_ns_amount + $holiday_legal_ns_ot_amount + $restday_legal_ns_amount + $restday_legal_ns_ot_amount;
      $holiday_legal       = $payslip_section_earnings['total_legal_amount']['value'];
      $gross_pay           = $basic_pay + $overtime_amount + $staff_benefits + $total_nightshift;
      $taxable_income;
        if ($frequency_type == "Bi-Monthly") {
          $bimonthly = $basic_pay * 2;
          if ($bimonthly > 20833 && $bimonthly < 33333 ) {
            $taxable_income      = $gross_pay + (0.2*($basic_pay  - 10416.5));
          } else if ($bimonthly > 33333 && $bimonthly < 66667 ) {
            $taxable_income      =  $gross_pay + (0.25*($basic_pay - 16666.5)) + 1250;
          } else if ($bimonthly > 66667 && $bimonthly < 166667) {
            $taxable_income      = $gross_pay + (0.3*($basic_pay - 33333.5)) + 5416.66;
          } else if ($bimonthly > 166667 && $bimonthly < 666667) {
            $taxable_income      = $gross_pay + (0.32*($basic_pay - 83333.5)) + 20416.67;
          } else if ($bimonthly > 666667) {
            $taxable_income      = $gross_pay + (0.35*($basic_pay - 333333.5)) + 100416.67;
          } else {
            $taxable_income = $gross_pay;
          }
        }
        else if ($frequency_type == "Weekly") {
          $weekly = $basic_pay * 4;
          if ($weekly > 20833 && $weekly < 33333 ) {
            $taxable_income      = $gross_pay + (0.2*($basic_pay  - 5208.25));
          } else if ($weekly > 33333 && $weekly < 66667 ) {
            $taxable_income      =  $gross_pay + (0.25*($basic_pay - 8333.25)) + 625;
          } else if ($weekly > 66667 && $weekly < 166667) {
            $taxable_income      = $gross_pay + (0.3*($basic_pay - 16666.75)) + 2708.33;
          } else if ($weekly > 166667 && $weekly < 666667) {
            $taxable_income      = $gross_pay + (0.32*($basic_pay - 41666.5)) + 10208.335;
          } else if ($weekly > 666667) {
            $taxable_income      = $gross_pay + (0.35*($basic_pay - 166666.75)) + 50208.335;
          } else {
            $taxable_income = $gross_pay;
          }
        }
    
       
      $hdmf_loan           = $payslip_section_deduction['pagibig_loan']['value'] + $payslip_section_deduction['pagibig_salary_loan']['value'];
      $hdmf_calamity       = $payslip_section_deduction['pagibig_calamity_loan']['value'];
      $sss_loan            = $payslip_section_deduction['sss_loan']['value'] + $payslip_section_deduction['sss_salary_loan']['value'] + $payslip_section_deduction['sss_calamity_loan']['value'];

      $staff_benefits_deductions_other_adj = 0;
      foreach ($other_deduction_label_array as $odla_key => $odla) {
        $staff_benefits_deductions_other_adj += $other_deductions_only[$odla_key]['value'];
      }

      //get loan amount
      $employee_deduction_container = [];
      $obj_other_deductions = unserialize($payslips[$employee_id]['other_deductions']);
      foreach($loan_label_container as $loan_type){
        $hasAmount = false;
        foreach ($obj_other_deductions as $other_deduction) {
          if($other_deduction->getLabel() == $loan_type){
            array_push($employee_deduction_container, $other_deduction->getAmount());
            $sub_total[$loan_type] += $other_deduction->getAmount();
            $hasAmount = true;
          }
        }
        if($hasAmount == false){
          array_push($employee_deduction_container, 0);
          $sub_total[$loan_type] += 0;
        }
      }

      $total_other_deduction = 0;
      //compute other deduction
      foreach ($obj_other_deductions as $other_deduction) {
        if( !in_array($other_deduction->getLabel(), $loan_label_container)){
          $total_other_deduction += $other_deduction->getAmount();
        }
      }

      $total_net_pay = 0;
      $total_net_pay = $net_pay;

      $sub_total['sl']              += $sl;
      $sub_total['vl']              += $vl;
      $sub_total['slvl']            += $slvl;
      $sub_total['legal_holiday']   += $emp_legal_holiday_amount;
      $sub_total['bil']             += $bil;

      $sub_total['tardiness'] = $tardiness;
      $sub_total['undertime'] = $undertime;
      $sub_total['absent']    = $absent;

      //$sub_total['seniority']       += $earnings_benefits_seniority_total;
      //$sub_total['transpo']          += $earnings_benefits_transpo_total;
      //$sub_total['meal']            += $earnings_benefits_meal_total;

      $sub_total['basic_pay']       += $basic_pay;
      $sub_total['total_basic_pay'] += $total_basic_pay;

      $sub_total['regular_ns_amount']             += $regular_ns_amount;
      $sub_total['regular_ns_ot_amount']          += $regular_ns_ot_amount;
      $sub_total['holiday_special_ns_amount']     += $holiday_special_ns_amount;
      $sub_total['restday_special_ns_amount']     += $restday_special_ns_amount;
      $sub_total['holiday_special_ns_ot_amount']  += $holiday_special_ns_ot_amount;
      $sub_total['restday_special_ns_ot_amount']  += $restday_special_ns_ot_amount;
      $sub_total['restday_ns_amount']             += $restday_ns_amount;
      $sub_total['restday_ns_ot_amount']          += $restday_ns_ot_amount;
      $sub_total['holiday_legal_ns_amount']       += $holiday_legal_ns_amount;
      $sub_total['holiday_legal_ns_ot_amount']    += $holiday_legal_ns_ot_amount;
      $sub_total['restday_legal_ns_amount']       += $restday_legal_ns_amount;
      $sub_total['restday_legal_ns_ot_amount']    += $restday_legal_ns_ot_amount;
      $sub_total['total_nightshift']              += $total_nightshift;

      $sub_total['regular_ot_amount']              += $regular_ot_amount;
      $sub_total['holiday_legal_amount']           += $holiday_legal_amount;
      $sub_total['holiday_legal_ot_amount']        += $holiday_legal_ot_amount;
      $sub_total['restday_legal_amount']           += $restday_legal_amount;
      $sub_total['restday_legal_ot_amount']        += $restday_legal_ot_amount;
      $sub_total['restday_amount']                 += $restday_amount;
      $sub_total['restday_ot_amount']              += $restday_ot_amount;
      $sub_total['holiday_special_amount']         += $holiday_special_amount;
      $sub_total['holiday_special_ot_amount']      += $holiday_special_ot_amount;
      $sub_total['restday_special_amount']         += $restday_special_amount;
      $sub_total['restday_special_ot_amount']      += $restday_special_ot_amount;
      $sub_total['overtime_amount']                += $overtime_amount;

      $sub_total['gross_pay']       += $gross_pay;
      $sub_total['taxable_earnings'] += $taxable_income;
      $sub_total['staff_benefits']  += $staff_benefits;
      $sub_total['witholding_tax']  += $witholding_tax;
      $sub_total['pagibig']         += $pagibig;
      $sub_total['philhealth']      += $philhealth;
      $sub_total['sss']             += $sss;
      $sub_total['total_govt_deductions_unions'] += $total_govt_deductions_unions;

      $sub_total['hdmf_loan']     += $hdmf_loan;
      $sub_total['hdmf_calamity'] += $hdmf_calamity;
      $sub_total['sss_loan']      += $sss_loan;
      $sub_total['staff_benefits_deductions_other_adj'] += $staff_benefits_deductions_other_adj;
      $sub_total['net_pay'] += $total_net_pay;
      $sub_total['other_deduction'] += $total_other_deduction;

      /* Sub total dynamic earnings */
      foreach ($earnings_benefits_label_array as $ebla_key => $ebla) {
        $sub_total[$ebla_key] += $payslip_section_other_earnings[$ebla_key]['value'];
      }
      /* Sub total dynamic earnings end*/

      /* Sub total dynamic other deduction */
      foreach ($other_deduction_label_array as $odla_key => $odla) {
        $sub_total[$odla_key] += $other_deductions_only[$odla_key]['value'];
      }
      /* Sub total dynamic other deduction end */


      $salary_type = '';
      if ($emp_salary_type == 'Monthly') {
        $salary_type = 'M';
      } else if ($emp_salary_type == 'Daily') {
        $salary_type = 'D';
      }

      ?>

      <tr height=20 style='height:15.0pt'>
        <td height=20 class=xl72 align=right style='height:15.0pt'>&nbsp;<?php echo $cdata['employee_code']; ?></td>
        <!-- <td class=xl72 style='border-left:none'>&nbsp;<?php //echo $cdata['hired_date']; 
                                                            ?></td> -->
        <td class=xl73>&nbsp;<?php echo $cdata['employment_status']; ?></td>
        <td class=xl73><?php echo $cdata['cost_center']; ?></td>
        <!-- <td class=xl73>&nbsp;<?php //echo $salary_type; 
                                  ?></td> -->
        <td class=xl73>&nbsp;<?php echo $lastname; ?>, <?php echo $firstname; ?></td>


        <!-- new -->
        <td class=xl73>&nbsp;<?php echo $department_name; ?></td>
        <td class=xl73>&nbsp;<?php echo $section_name; ?></td>
        <td class=xl73>&nbsp;<?php echo $frequency_type; ?></td>
        <!-- new -->

        <!-- <td class=xl73>&nbsp;<?php echo $marital_status; ?><?php echo $number_dependent > 0 ? $number_dependent : ''; ?></td>
          <td class=xl73>&nbsp;<?php echo number_format($emp_monthly_rate, 2, '.', ','); ?></td>
          <td class=xl73>&nbsp;<?php echo number_format($emp_daily_rate, 2, '.', ','); ?></td>
          <td class=xl73>&nbsp;<?php echo number_format($emp_hourly_rate, 2, '.', ','); ?></td>
          <td class=xl73>&nbsp;<?php echo number_format($full_hours, 2, '.', ','); ?></td>
          <td class=xl74><?php echo number_format($basic_pay, 2, '.', ','); ?>&nbsp;</td> -->

        <!-- <td class=xl74><?php echo number_format($sl, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($vl, 2, '.', ','); ?>&nbsp;</td> -->

        <!--  <td class=xl74><?php echo number_format($slvl, 2, '.', ','); ?>&nbsp;</td> -->
        <!-- <td class=xl74>&nbsp;<?php //echo number_format($emp_legal_holiday_amount,2, '.' , ',' ); 
                                  ?></td> -->

        <!-- <td class=xl74><?php echo number_format($bil, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($tardiness, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($undertime, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($absent, 2, '.', ','); ?>&nbsp;</td>   -->

        <!-- 
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;-</td>
          <td class=xl74>-</td>
          <td class=xl74>-</td>
          <td class=xl74>-</td> 
          -->

        <td class=xl74><?php echo number_format($total_basic_pay, 2, '.', ','); ?></td>

        <!-- <td class=xl74><?php echo number_format($regular_ns_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($regular_ns_ot_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($holiday_special_ns_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($restday_special_ns_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($holiday_special_ns_ot_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($restday_special_ns_ot_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($restday_ns_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($restday_ns_ot_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($holiday_legal_ns_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($holiday_legal_ns_ot_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($restday_legal_ns_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($restday_legal_ns_ot_amount, 2, '.', ','); ?>&nbsp;</td> -->

        <td class=xl74><?php echo number_format($total_nightshift, 2, '.', ','); ?></td>

        <!-- <td class=xl74><?php echo number_format($regular_ot_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($holiday_legal_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($holiday_legal_ot_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($restday_legal_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($restday_legal_ot_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($restday_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($restday_ot_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($holiday_special_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($holiday_special_ot_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($restday_special_amount, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($restday_special_ot_amount, 2, '.', ','); ?>&nbsp;</td> -->

        <!--
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td> 
          -->

        <td class=xl74><?php echo number_format($overtime_amount, 2, '.', ','); ?></td>

        <!-- <td class=xl74>- &nbsp;</td>
          <td class=xl74><?php //echo number_format($earnings_benefits_seniority_total,2, '.' , ',' ); 
                          ?>&nbsp;</td>
          <td class=xl74><?php //echo number_format($earnings_benefits_transpo_total,2, '.' , ',' ); 
                          ?>&nbsp;</td>
          <td class=xl74><?php //echo number_format($earnings_benefits_meal_total,2, '.' , ',' ); 
                          ?>&nbsp;</td>
          <td class=xl74>-&nbsp;</td>
          <td class=xl74>-&nbsp;</td>
          <td class=xl74>-&nbsp;</td> -->

        <!-- <?php foreach ($earnings_benefits_label_array as $ebla_key => $ebla) { ?>
                  <td class=xl74><?php echo number_format($payslip_section_other_earnings[$ebla_key]['value'], 2, '.', ','); ?>&nbsp;</td>
          <?php } ?>  -->

        <td class=xl74><?php echo number_format($staff_benefits, 2, '.', ','); ?></td>
        <td class=xl74><?php echo number_format($gross_pay, 2, '.', ','); ?></td>
        <td class=xl74><?php echo number_format($taxable_income, 2, '.', ','); ?></td>

        <!-- <td class=xl74><?php echo number_format($total_govt_deductions_unions, 2, '.', ','); ?>&nbsp;</td> -->

        <td class=xl74><?php echo number_format($philhealth, 2, '.', ','); ?></td>
        <td class=xl74><?php echo number_format($sss, 2, '.', ','); ?></td>
        <td class=xl74><?php echo number_format($pagibig, 2, '.', ','); ?></td>
        <td class=xl74><?php echo number_format($witholding_tax, 2, '.', ','); ?></td>

        <!-- <td class=xl74><?php echo number_format($hdmf_loan, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($hdmf_calamity, 2, '.', ','); ?>&nbsp;</td>
          <td class=xl74><?php echo number_format($sss_loan, 2, '.', ','); ?>&nbsp;</td> -->

        <!-- <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td>
          <td class=xl74>&nbsp;</td> -->

        <!-- <?php foreach ($other_deduction_label_array as $odla_key => $odla) { ?>
                  <td class=xl74><?php echo number_format($other_deductions_only[$odla_key]['value'], 2, '.', ','); ?>&nbsp;</td>
          <?php } ?>      -->

        <?php foreach($employee_deduction_container as $amount){ ?>
          <td class=xl78 style="border-right: 0.5pt solid windowtext"><strong><?=$amount?></strong>&nbsp;</td>
        <?php } ?>
        <td class=xl78 style="border-right: 0.5pt solid windowtext"><strong><?=$total_other_deduction?></strong>&nbsp;</td>
        <td class=xl74><?php echo number_format($total_net_pay, 2, '.', ','); ?></td>
        <td class=xl74>-</td>
        <td class=xl74>-</td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
        <td class=xl67></td>
      </tr>

    <?php } ?>

    <tr height=20 style='height:15.0pt'>
      <td colspan=6 height=20 class=xl83 style='border-right:.5pt solid black; height:15.0pt'>&nbsp; <font class="font8">Total:</font>
      </td>
      <!-- <td class=xl76>&nbsp;</td> -->

      <!-- <td class=xl75>&nbsp;</td>
          <td class=xl76>&nbsp;</td> -->

      <!-- <td class=xl76>&nbsp;</td> -->

      <!-- <td class=xl76>&nbsp;</td>
          <td class=xl76>&nbsp;</td>
          <td class=xl76>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['basic_pay'], 2, '.', ','); ?></strong>&nbsp;</td> -->

      <!-- <td class=xl77><strong><?php echo number_format($sub_total['sl'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['vl'], 2, '.', ','); ?></strong>&nbsp;</td> -->

      <td class=xl77><strong><?php echo number_format($sub_total['slvl'], 2, '.', ','); ?></strong></td>

      <!-- <td class=xl77><strong><?php echo number_format($sub_total['bil'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['tardiness'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['undertime'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['absent'], 2, '.', ','); ?></strong>&nbsp;</td> -->

      <!-- <td class=xl77>&nbsp;</td> -->
      <!-- 
          <td class=xl77><strong>&nbsp;</td>
          <td class=xl77>&nbsp;-</td>
          <td class=xl77>--</td>
          <td class=xl77>--</td>
          <td class=xl77>--</td> 
          -->

      <td class=xl77><strong><?php echo number_format($sub_total['total_basic_pay'], 2, '.', ','); ?></strong></td>

      <!-- <td class=xl77><strong><?php echo number_format($sub_total['regular_ns_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['regular_ns_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['holiday_special_ns_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['restday_special_ns_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['holiday_special_ns_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['restday_special_ns_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['restday_ns_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['restday_ns_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['holiday_legal_ns_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['holiday_legal_ns_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['restday_legal_ns_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['restday_legal_ns_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td> -->

      <td class=xl77><strong><?php echo number_format($sub_total['total_nightshift'], 2, '.', ','); ?></strong></td>

      <!-- <td class=xl77><strong><?php echo number_format($sub_total['regular_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['holiday_legal_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['holiday_legal_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['restday_legal_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['restday_legal_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['restday_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['restday_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['holiday_special_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['holiday_special_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['restday_special_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['restday_special_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td> -->

      <!-- 
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td> 
          -->

      <td class=xl77><strong><?php echo number_format($sub_total['overtime_amount'], 2, '.', ','); ?></strong></td>

      <!-- <td class=xl77>-&nbsp;</td>
          <td class=xl77><strong><?php //echo number_format($sub_total['seniority'],2, '.' , ',' ); 
                                  ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php //echo number_format($sub_total['transpo'],2, '.' , ',' ); 
                                  ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php //echo number_format($sub_total['meal'],2, '.' , ',' ); 
                                  ?></strong>&nbsp;</td>
          <td class=xl77>-&nbsp;</td>
          <td class=xl77>-&nbsp;</td>
          <td class=xl77>-&nbsp;</td> -->

      <!-- <?php foreach ($earnings_benefits_label_array as $ebla_key => $ebla) { ?>
                  <td class=xl77><strong><?php echo number_format($sub_total[$ebla_key], 2, '.', ','); ?></strong>&nbsp;</td>
          <?php } ?>  -->

      <td class=xl77><strong><?php echo number_format($sub_total['staff_benefits'], 2, '.', ','); ?></strong></td>
      <td class=xl77><strong><?php echo number_format($sub_total['gross_pay'], 2, '.', ','); ?></strong></td>
      <td class=xl77><strong><?php echo number_format($sub_total['taxable_earnings'], 2, '.', ','); ?></strong></td>

      <!-- <td class=xl77><strong><?php echo number_format($sub_total['total_govt_deductions_unions'], 2, '.', ','); ?></strong>&nbsp;</td> -->

      <td class=xl77><strong><?php echo number_format($sub_total['philhealth'], 2, '.', ','); ?></strong></td>
      <td class=xl77><strong><?php echo number_format($sub_total['sss'], 2, '.', ','); ?></strong></td>
      <td class=xl77><strong><?php echo number_format($sub_total['pagibig'], 2, '.', ','); ?></strong></td>
      <td class=xl77><strong><?php echo number_format($sub_total['witholding_tax'], 2, '.', ','); ?></strong></td>

      <!-- <td class=xl77><strong><?php echo number_format($sub_total['hdmf_loan'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['hdmf_calamity'], 2, '.', ','); ?></strong>&nbsp;</td>
          <td class=xl77><strong><?php echo number_format($sub_total['sss_loan'], 2, '.', ','); ?></strong>&nbsp;</td> -->

      <!-- <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td>
          <td class=xl77>&nbsp;</td> -->

      <!-- <?php foreach ($other_deduction_label_array as $odla_key => $odla) { ?>
                  <td class=xl77><strong><?php echo number_format($sub_total[$odla_key], 2, '.', ','); ?></strong>&nbsp;</td>
          <?php } ?> -->

      <!-- <td class=xl77><strong><?php echo number_format($sub_total['staff_benefits_deductions_other_adj'], 2, '.', ','); ?></strong>&nbsp;</td> -->
      <?php foreach($loan_label_container as $loan_type){?>
            <td class=xl77 style="border-top: 0.5pt solid windowtext"><strong><?=number_format($sub_total[$loan_type],2, '.' , ',' );?></strong></td>
          <?php }?>
          <td class=xl77 style="border-top: 0.5pt solid windowtext"><strong><?=$sub_total['other_deduction']?></strong>&nbsp;</td>
      <td class=xl77><strong><?php echo number_format($sub_total['net_pay'], 2, '.', ','); ?></strong></td>
      <td class=xl77>--</td>
      <td class=xl77>--</td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
      <td class=xl67></td>
    </tr>

    <?php
    $grand_total['sl']              += $sub_total['sl'];
    $grand_total['vl']              += $sub_total['vl'];
    $grand_total['slvl']            += $sub_total['slvl'];
    $grand_total['legal_holiday']   += $sub_total['legal_holiday'];
    $grand_total['bil']             += $sub_total['bil'];
    $grand_total['basic_pay']       += $sub_total['basic_pay'];
    $grand_total['total_basic_pay'] += $sub_total['total_basic_pay'];

    $grand_total['tardiness']       += $sub_total['tardiness'];
    $grand_total['undertime']       += $sub_total['undertime'];
    $grand_total['absent']          += $sub_total['absent'];

    $grand_total['regular_ns_amount']               += $sub_total['regular_ns_amount'];
    $grand_total['regular_ns_ot_amount']            += $sub_total['regular_ns_ot_amount'];
    $grand_total['holiday_special_ns_amount']       += $sub_total['holiday_special_ns_amount'];
    $grand_total['restday_special_ns_amount']       += $sub_total['restday_special_ns_amount'];
    $grand_total['holiday_special_ns_ot_amount']    += $sub_total['holiday_special_ns_ot_amount'];
    $grand_total['restday_special_ns_ot_amount']    += $sub_total['restday_special_ns_ot_amount'];
    $grand_total['restday_ns_amount']               += $sub_total['restday_ns_amount'];
    $grand_total['restday_ns_ot_amount']            += $sub_total['restday_ns_ot_amount'];
    $grand_total['holiday_legal_ns_amount']         += $sub_total['holiday_legal_ns_amount'];
    $grand_total['holiday_legal_ns_ot_amount']      += $sub_total['holiday_legal_ns_ot_amount'];
    $grand_total['restday_legal_ns_amount']         += $sub_total['restday_legal_ns_amount'];
    $grand_total['restday_legal_ns_ot_amount']      += $sub_total['restday_legal_ns_ot_amount'];
    $grand_total['total_nightshift']                += $sub_total['total_nightshift'];

    $grand_total['regular_ot_amount'] += $sub_total['regular_ot_amount'];
    $grand_total['holiday_legal_amount'] += $sub_total['holiday_legal_amount'];
    $grand_total['holiday_legal_ot_amount'] += $sub_total['holiday_legal_ot_amount'];
    $grand_total['restday_legal_amount'] += $sub_total['restday_legal_amount'];
    $grand_total['restday_legal_ot_amount'] += $sub_total['restday_legal_ot_amount'];
    $grand_total['restday_amount'] += $sub_total['restday_amount'];
    $grand_total['restday_ot_amount'] += $sub_total['restday_ot_amount'];
    $grand_total['holiday_special_amount'] += $sub_total['holiday_special_amount'];
    $grand_total['holiday_special_ot_amount'] += $sub_total['holiday_special_ot_amount'];
    $grand_total['restday_special_amount'] += $sub_total['restday_special_amount'];
    $grand_total['restday_special_ot_amount'] += $sub_total['restday_special_ot_amount'];
    $grand_total['overtime_amount'] += $sub_total['overtime_amount'];

    //$grand_total['seniority']       += $sub_total['seniority'];
    //$grand_total['transpo']          += $sub_total['transpo'];
    //$grand_total['meal']            += $sub_total['meal'];

    $grand_total['staff_benefits']  += $sub_total['staff_benefits'];
    $grand_total['gross_pay']       += $sub_total['gross_pay'];
    $grand_total['taxable_earnings'] += $sub_total['taxable_earnings'];
    $grand_total['total_govt_deductions_unions'] += $sub_total['total_govt_deductions_unions'];
    $grand_total['pagibig']         += $sub_total['pagibig'];
    $grand_total['witholding_tax']  += $sub_total['witholding_tax'];
    $grand_total['philhealth']      += $sub_total['philhealth'];
    $grand_total['sss']             += $sub_total['sss'];

    $grand_total['hdmf_loan']       += $sub_total['hdmf_loan'];
    $grand_total['hdmf_calamity']   += $sub_total['hdmf_calamity'];
    $grand_total['sss_loan']        += $sub_total['sss_loan'];
    $grand_total['staff_benefits_deductions_other_adj'] += $sub_total['staff_benefits_deductions_other_adj'];

    $grand_total['net_pay']         += $sub_total['net_pay'];
    $grand_total['other_deduction'] += $sub_total['other_deduction'];
    foreach($loan_label_container as $loan_type){
      $grand_total[$loan_type] += $sub_total[$loan_type];
    }

    foreach ($earnings_benefits_label_array as $ebla_key => $ebla) {
      $grand_total[$ebla_key] += $sub_total[$ebla_key];
    }

    foreach ($other_deduction_label_array as $odla_key => $odla) {
      $grand_total[$odla_key] += $sub_total[$odla_key];
    }
    ?>
  <?php } ?>

  <tr height=20 style='height:15.0pt'>
    <td height=20 class=xl67 style='height:15.0pt'></td>
    <td class=xl67></td>
    <td class=xl68></td>
    <td class=xl68></td>
    <td class=xl68></td>
    <td class=xl67></td>
    <td class=xl69></td>
    <td class=xl69></td>
    <td class=xl69></td>
    <td class=xl69></td>
    <td class=xl69></td>
    <td class=xl69></td>
    <td class=xl69></td>
    <td class=xl69></td>
    <td class=xl67></td>
    <!-- <td class=xl67></td> -->
    <td class=xl67></td>

    <!--
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  -->

    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>

    <!-- 
  <td class=xl67></td>
  <td class=xl67></td> 
  -->

    <td class=xl67></td>

    <!-- <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td>
  <td class=xl67></td> -->
    <?php foreach ($earnings_benefits_label_array as $ebla_key => $ebla) { ?>
      <td class=xl67></td>
    <?php } ?>

    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td colspan=18 style='mso-ignore:colspan'></td>
  </tr>

  <tr height=20 style='height:15.0pt'>
    <td height=20 class=xl78 style='height:15.0pt'>&nbsp;</td>
    <!-- <td class=xl78>&nbsp;</td> -->
    <td class=xl78>&nbsp;</td>
    <td class=xl79>&nbsp;</td>
    <!-- <td class=xl79>&nbsp;</td> -->
    <td class=xl79>Grand Total:</td>

    <td class=xl79>&nbsp;</td>
    <td class=xl79>&nbsp;</td>

    <!-- <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['basic_pay'], 2, '.', ','); ?></strong>&nbsp;</td> -->

    <!-- <td class=xl78><strong><?php echo number_format($grand_total['sl'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['vl'], 2, '.', ','); ?></strong>&nbsp;</td> -->

    <td class=xl78><strong><?php echo number_format($grand_total['slvl'], 2, '.', ','); ?></strong></td>

    <!-- <td class=xl78><strong><?php echo number_format($grand_total['bil'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['tardiness'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['undertime'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['absent'], 2, '.', ','); ?></strong>&nbsp;</td> -->

    <!-- <td class=xl78>&nbsp;<strong><?php //echo number_format($grand_total['legal_holiday'],2, '.' , ',' ); 
                                      ?></strong></td> -->
    <!-- 
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  -->

    <td class=xl78><strong><?php echo number_format($grand_total['total_basic_pay'], 2, '.', ','); ?></strong></td>

    <!-- <td class=xl78><strong><?php echo number_format($grand_total['regular_ns_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['regular_ns_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['holiday_special_ns_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['restday_special_ns_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['holiday_special_ns_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['restday_special_ns_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['restday_ns_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['restday_ns_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['holiday_legal_ns_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['holiday_legal_ns_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['restday_legal_ns_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['restday_legal_ns_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td> -->

    <td class=xl78><strong><?php echo number_format($grand_total['total_nightshift'], 2, '.', ','); ?></strong></td>

    <!-- <td class=xl78><strong><?php echo number_format($grand_total['regular_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['holiday_legal_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['holiday_legal_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['restday_legal_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['restday_legal_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['restday_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['restday_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['holiday_special_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['holiday_special_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['restday_special_amount'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['restday_special_ot_amount'], 2, '.', ','); ?></strong>&nbsp;</td> -->

    <!-- 
  <td class=xl78>-&nbsp;</td>
  <td class=xl78>-&nbsp;</td> 
  -->

    <td class=xl78><strong><?php echo number_format($grand_total['overtime_amount'], 2, '.', ','); ?></strong></td>

    <!-- <td class=xl78>-&nbsp;</td>
  <td class=xl78><strong><?php //echo number_format($grand_total['seniority'],2, '.' , ',' ); 
                          ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php //echo number_format($grand_total['transpo'],2, '.' , ',' ); 
                          ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php //echo number_format($grand_total['meal'],2, '.' , ',' ); 
                          ?></strong>&nbsp;</td>
  <td class=xl78>-&nbsp;</td>
  <td class=xl78>-&nbsp;</td>
  <td class=xl78>-&nbsp;</td> -->

    <!-- <?php foreach ($earnings_benefits_label_array as $ebla_key => $ebla) { ?>
          <td class=xl78><strong><?php echo number_format($grand_total[$ebla_key], 2, '.', ','); ?></strong>&nbsp;</td>
  <?php } ?>     -->

    <td class=xl78><strong><?php echo number_format($grand_total['staff_benefits'], 2, '.', ','); ?></strong></td>
    <td class=xl78><strong><?php echo number_format($grand_total['gross_pay'], 2, '.', ','); ?></strong></td>
    <td class=xl78><strong><?php echo number_format($grand_total['taxable_earnings'], 2, '.', ','); ?></strong></td>

    <!-- <td class=xl78><strong><?php echo number_format($grand_total['total_govt_deductions_unions'], 2, '.', ','); ?></strong>&nbsp;</td> -->

    <td class=xl78><strong><?php echo number_format($grand_total['philhealth'], 2, '.', ','); ?></strong></td>
    <td class=xl78><strong><?php echo number_format($grand_total['sss'], 2, '.', ','); ?></strong></td>
    <td class=xl78><strong><?php echo number_format($grand_total['pagibig'], 2, '.', ','); ?></strong></td>
    <td class=xl78><strong><?php echo number_format($grand_total['witholding_tax'], 2, '.', ','); ?></strong></td>

    <!-- <td class=xl78><strong><?php echo number_format($grand_total['hdmf_loan'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['hdmf_calamity'], 2, '.', ','); ?></strong>&nbsp;</td>
  <td class=xl78><strong><?php echo number_format($grand_total['sss_loan'], 2, '.', ','); ?></strong>&nbsp;</td> -->

    <!-- <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td>
  <td class=xl78>-</td> -->

    <!-- <?php foreach ($other_deduction_label_array as $odla_key => $odla) { ?>
          <td class=xl78><strong><?php echo number_format($grand_total[$odla_key], 2, '.', ','); ?></strong>&nbsp;</td>
  <?php } ?> -->

    <!-- <td class=xl78><strong><?php echo number_format($grand_total['staff_benefits_deductions_other_adj'], 2, '.', ','); ?></strong>&nbsp;</td> -->
    <?php foreach($loan_label_container as $loan_type){?>
              <td class=xl78><strong><?=number_format($grand_total[$loan_type],2, '.' , ',' )?></strong></td>
    <?php }?>
    <td class=xl78><strong><?=number_format($grand_total['other_deduction'],2, '.' , ',' )?></strong></td>
    <td class=xl78><strong><?php echo number_format($grand_total['net_pay'], 2, '.', ','); ?></strong></td>
    <td class=xl78>-</td>
    <td class=xl78>-</td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
    <td class=xl67></td>
  </tr>

  <![if supportMisalignedColumns]>
  <tr height=0 style='display:none'>
    <td width=76 style='width:57pt'></td>
    <td width=76 style='width:57pt'></td>
    <td width=76 style='width:57pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=177 style='width:133pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=70 style='width:53pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=70 style='width:53pt'></td>
    <!-- <td width=79 style='width:59pt'></td> -->
    <td width=79 style='width:59pt'></td>

    <!--
  <td width=79 style='width:59pt'></td>
  <td width=72 style='width:54pt'></td>
  <td width=76 style='width:57pt'></td>
  <td width=86 style='width:65pt'></td>
  <td width=82 style='width:62pt'></td>
  -->

    <td width=78 style='width:59pt'></td>
    <td width=72 style='width:54pt'></td>
    <td width=72 style='width:54pt'></td>
    <td width=72 style='width:54pt'></td>
    <td width=72 style='width:54pt'></td>
    <td width=72 style='width:54pt'></td>
    <td width=74 style='width:56pt'></td>
    <td width=75 style='width:56pt'></td>
    <td width=75 style='width:56pt'></td>
    <td width=76 style='width:57pt'></td>
    <td width=72 style='width:54pt'></td>
    <td width=75 style='width:56pt'></td>
    <td width=77 style='width:58pt'></td>
    <td width=95 style='width:71pt'></td>
    <td width=107 style='width:80pt'></td>
    <td width=107 style='width:80pt'></td>
    <td width=107 style='width:80pt'></td>
    <td width=107 style='width:80pt'></td>
    <td width=107 style='width:80pt'></td>
    <td width=107 style='width:80pt'></td>
    <td width=107 style='width:80pt'></td>
    <td width=107 style='width:80pt'></td>
    <td width=107 style='width:80pt'></td>
    <td width=107 style='width:80pt'></td>
    <td width=107 style='width:80pt'></td>

    <!-- 
  <td width=107 style='width:80pt'></td>
  <td width=107 style='width:80pt'></td> 
  -->

    <td width=91 style='width:68pt'></td>

    <!-- <td width=78 style='width:59pt'></td>
  <td width=78 style='width:59pt'></td>
  <td width=83 style='width:62pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td> -->
    <?php foreach ($earnings_benefits_label_array as $ebla_key => $ebla) { ?>
      <td width=64 style='width:48pt'></td>
    <?php } ?>

    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=105 style='width:79pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=78 style='width:59pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=79 style='width:59pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=71 style='width:53pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
    <td width=64 style='width:48pt'></td>
  </tr>
  <![endif]>
</table>
<?php
header('Content-type: application/ms-excel');
header("Content-Disposition: attachment; filename=payroll_register({$cutoff_code}).xls");
header("Pragma: no-cache");
header("Expires: 0");
?>